@import url('https://fonts.googleapis.com/css2?family=Lexend:wght@100..900&family=Radio+Canada:ital,wght@0,300..700;1,300..700&display=swap');

@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
    :root {
        --snow: #fcf7f8;
        --seafoam: #fef9de;
        --egypt: #f8f0e2;
        --madder: #931335;
        --oxblood: #622032;
    }

    body {
        font-family: "Radio Canada", sans-serif;
        padding-bottom: env(safe-area-inset-bottom);
    }

    h1, h2, h3, h4, h5, h6 {
        font-family: "Lexend", sans-serif;
    }

    /* Page Transitions */
    .page-transition-enter {
        opacity: 0;
        transform: scale(0.95);
    }

    .page-transition-enter-active {
        opacity: 1;
        transform: scale(1);
        transition: opacity 300ms ease-out, transform 300ms ease-out;
    }

    .page-transition-exit {
        opacity: 1;
        transform: scale(1);
    }

    .page-transition-exit-active {
        opacity: 0;
        transform: scale(1.05);
        transition: opacity 300ms ease-in, transform 300ms ease-in;
    }
}

@layer utilities {
    .safe-area-bottom {
        padding-bottom: env(safe-area-inset-bottom);
    }

    /* Page Loading Overlay - PWA Optimized */
    .page-loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, rgba(252, 247, 248, 0.98) 0%, rgba(248, 240, 226, 0.98) 100%);
        z-index: 9999;
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.2s ease-out;
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        /* Hardware acceleration for smooth animations on all platforms */
        transform: translateZ(0);
        -webkit-transform: translateZ(0);
        will-change: opacity;
        /* Prevent tap highlighting on mobile */
        -webkit-tap-highlight-color: transparent;
        /* Prevent selection during loading */
        user-select: none;
        -webkit-user-select: none;
        /* Ensure it covers safe areas on iOS */
        padding-top: env(safe-area-inset-top);
        padding-bottom: env(safe-area-inset-bottom);
    }

    .page-loading-overlay.active {
        opacity: 1;
        pointer-events: all;
    }

    /* Loading Spinner - GPU Accelerated */
    .loading-spinner {
        width: 48px;
        height: 48px;
        border: 3px solid rgba(147, 19, 53, 0.1);
        border-top-color: #931335;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
        /* Hardware acceleration */
        transform: translateZ(0);
        -webkit-transform: translateZ(0);
        will-change: transform;
    }

    @keyframes spin {
        0% {
            transform: rotate(0deg) translateZ(0);
            -webkit-transform: rotate(0deg) translateZ(0);
        }
        100% {
            transform: rotate(360deg) translateZ(0);
            -webkit-transform: rotate(360deg) translateZ(0);
        }
    }

    /* Ensure smooth animations on iOS Safari */
    @supports (-webkit-overflow-scrolling: touch) {
        .page-loading-overlay {
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            -webkit-perspective: 1000;
            perspective: 1000;
        }
    }

    /* Loading Pulse Animation (Alternative) */
    .loading-pulse {
        display: flex;
        gap: 8px;
    }

    .loading-pulse span {
        width: 12px;
        height: 12px;
        background: #931335;
        border-radius: 50%;
        animation: pulse 1.4s ease-in-out infinite;
    }

    .loading-pulse span:nth-child(2) {
        animation-delay: 0.2s;
    }

    .loading-pulse span:nth-child(3) {
        animation-delay: 0.4s;
    }

    @keyframes pulse {
        0%, 80%, 100% {
            opacity: 0.3;
            transform: scale(0.8);
        }
        40% {
            opacity: 1;
            transform: scale(1);
        }
    }
}

@layer components {
    /* Layout Container */
    .safe-area {
        @apply px-4 sm:px-6 md:px-8;
    }

    .page-container {
        @apply max-w-7xl mx-auto w-full;
    }

    /* Modal Styles */
    .modal-backdrop {
        @apply fixed inset-0 bg-black/30 backdrop-blur-sm z-50;
    }

    .modal-container {
        @apply fixed inset-x-0 bottom-0 z-50 transform transition-transform duration-300 ease-out;
    }

    .modal-content {
        @apply bg-white rounded-t-2xl max-h-[90vh] overflow-y-auto overscroll-contain;
    }

    /* Add this class to body when modal is open */
    .modal-open {
        @apply overflow-hidden touch-none;
    }

    /* Header Styles */
    .mobile-header {
        @apply bg-white border-b border-[#f8f0e2]/50 top-0 z-40
               backdrop-blur-sm bg-white/90 supports-[backdrop-filter]:bg-white/60;
    }

    .avatar {
        @apply w-10 h-10 sm:w-12 sm:h-12 rounded-full 
               bg-gradient-to-br from-[#931335] to-[#622032] 
               flex items-center justify-center 
               text-white font-bold text-base sm:text-lg
               ring-2 ring-white shadow-md;
    }

    /* Bottom Navigation */
    .bottom-nav {
        @apply fixed bottom-0 left-0 right-0 z-40 
               bg-white/95 backdrop-blur-sm border-t border-[#f8f0e2] 
               safe-area-bottom;
    }

    /* Page Layout */
    .page-wrapper {
        @apply min-h-screen flex flex-col bg-[#fcf7f8];
    }

    .page-content {
        @apply flex-1 pb-[calc(4rem+env(safe-area-inset-bottom))];
    }

    .bottom-nav-container {
        @apply max-w-lg mx-auto px-4 py-2;
    }

    .bottom-nav-item {
        @apply relative flex flex-col items-center py-2 px-3 transition-colors duration-200;
    }

    .bottom-nav-item.active {
        @apply text-[#931335];
    }

    .bottom-nav-item:not(.active) {
        @apply text-[#622032]/50 hover:text-[#931335];
    }

    .bottom-nav-indicator {
        @apply absolute bottom-0 left-1/2 w-1 h-1 -translate-x-1/2 rounded-full bg-[#931335];
    }

    .nav-item {
        @apply flex-1 px-1 py-3 text-center relative;
        @apply flex flex-col items-center justify-center;
        @apply text-[#622032]/60 hover:text-[#931335];
        @apply transition-all duration-200;
    }

    .nav-item.active {
        @apply text-[#931335] after:absolute after:bottom-0 after:left-0 
               after:w-full after:h-0.5 after:bg-[#931335]
               after:transform after:scale-x-100;
    }

    .nav-item.active::before {
        @apply content-[''] absolute -inset-1 -top-2 
               bg-[#931335]/5 rounded-lg -z-10;
    }

    .nav-icon {
        @apply w-6 h-6 mb-1;
    }

    .nav-text {
        @apply text-xs font-medium;
    }

    .btn-primary {
        @apply bg-[#931335] hover:bg-[#622032] text-white font-medium text-sm py-2 px-4 rounded-lg shadow transition-all duration-200 active:scale-95;
    }

    .btn-secondary {
        @apply bg-[#f8f0e2] hover:bg-[#dfd1ba] text-[#622032] font-medium text-sm py-2 px-4 rounded-lg transition-all duration-200 active:scale-95;
    }

    .input-field {
        @apply w-full px-4 py-3 bg-[#fcf7f8] border border-[#dfd1ba] rounded-lg transition-all duration-200
               outline-none text-[#622032]
               focus:outline-none focus:border-[#931335]/20 focus:ring-2 focus:ring-[#931335]/10 focus:shadow-[0_0_0_4px_rgba(147,19,53,0.05)]
               focus-visible:outline-none;
    }

    .error-message {
        @apply relative overflow-hidden bg-gradient-to-r from-red-50 to-red-50 
               border-l-2 sm:border-l-4 border-red-500 
               p-3 sm:p-4 mb-4 sm:mb-6 
               rounded-lg shadow-sm;
    }

    .error-message p {
        @apply text-[13px] sm:text-sm text-red-800 relative z-10 pl-7 sm:pl-8;
    }

    .error-message::before {
        content: '';
        @apply absolute inset-0 opacity-10;
        background-image: url("data:image/svg+xml,%3Csvg width='24' height='24' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill='%23991B1B' fill-opacity='0.05' d='M0 0h24v24H0z'/%3E%3C/svg%3E");
    }

    .error-icon {
        @apply absolute left-3 top-1/2 -translate-y-1/2
               text-red-500
               w-4 h-4 sm:w-5 sm:h-5;
    }

    /* Pagination Styles */
    .pagination-btn {
        @apply inline-flex items-center justify-center
               min-w-[2rem] sm:min-w-[2.5rem] h-8 sm:h-10
               px-2 sm:px-3
               text-xs sm:text-sm font-medium
               rounded-lg
               transition-all duration-200
               select-none;
    }

    .pagination-btn-page {
        @apply text-[#622032] bg-white
               border border-[#f8f0e2]
               hover:bg-[#f8f0e2] hover:border-[#622032]/20
               active:scale-95
               focus:outline-none focus:ring-2 focus:ring-[#622032]/20;
    }

    .pagination-btn-active {
        @apply text-white bg-[#931335]
               border border-[#931335]
               shadow-md
               ring-2 ring-[#931335]/20
               cursor-default;
    }

    .pagination-btn-nav {
        @apply text-[#622032] bg-white
               border border-[#f8f0e2]
               hover:bg-[#931335] hover:text-white hover:border-[#931335]
               active:scale-95
               focus:outline-none focus:ring-2 focus:ring-[#622032]/20
               font-semibold;
    }

    .pagination-btn-disabled {
        @apply text-[#622032]/30 bg-[#fcf7f8]
               border border-[#f8f0e2]
               cursor-not-allowed
               opacity-50;
    }
}